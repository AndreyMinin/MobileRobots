# Разработка модуля управления скоростью мобильного робота(МР) 
В этой задаче мы будем управлять скоростью движения МР в виртуальной среде (эта задача подготовлена только для варианта со средой моделирования Stage)

По сравнению с предыдущей задачей, где можно было напрямую управлять скоростью МР, здесь добавлен модуль, который имитирует работу акселлеротора (педали газа) и тормоза, которыми мы должны управлять, чтобы поддерживать заданный уровень скорости.

Этот модуль на вход получает заданное значение газа или тормоза в топик /robot/throttle (положительное значение соответствует газу - разгону робота, а отрицательное тормозу - замедлению) и задает скорость движения модели в среде на основе "неизвестных" нелинейных функции.

При этом робот сохраняет свое положение на траектории с помощью контроллера управления поворотом руля, разработанным на предыдущем занятии (запускается модуль из проекта simple_controller)

1. Находясь в папке репозитория нужно обновить (или создать заново) локальную копию
```bash
git pull
```

2. Переходим в рабочую папку и собираем проект
```bash
cd mr_ws
catkin_make
```

3. Запускаем модель с модулем акселлератора (предварительно проинициализировав workspace)
```bash
source devel/setup.bash
roslaunch velocity_controller throttle_cart.launch
```
Запустится среда моделирования с роботом, все необходимые программные модули. В дальнейшем (если робот не сойдет с траектории) среду можно не перезапускать.

4. Запускаем контроллер управления скоростью. Запускаем его из отдельного терминала, перейдя в workspace и проинициализировав его:
```bash
source devel/setup.bash
roslaunch velocity_controller controller.launch
```
При этом запустится модуль управления скоростью из проекта `velocity_controller` с параметрами из лонч файла [controller.launch](https://github.com/AndreyMinin/MobileRobots/blob/master/mr_ws/src/velocity_controller/launch/controller.launch), а также rqt с подготовленной перспективой, с выводом графиков текущей и заданной скорсти и графика ошибки.
В начальный момент ничего происходить не будет, так как нет заданной скорости и не реализован контроллер управления скоростью (пока это пустая программа, которая отправляет какое-то константное значение команды)

Также в rqt есть перспектива publish_messаge, через которую можно отправить команду в топик /robot/throttle, чтобы посмотреть как робот будет разгоняться и тормозить.

5. Запускаем тестовую программу, которая присылает задание скорости в виде трапеции (разгон - движение с постоянной скоростью - торможение). Запускаем ее из отдельного терминала перейдя в рабочую папку ros проекта и проинициализировав его.
```bash
source devel/setup.bash
roslaunch velocity_controller test.launch
```
Запустится модуль velocity_test из пакета velocity_cntroller с параметрами из лонч файла [test.launch](https://github.com/AndreyMinin/MobileRobots/blob/master/mr_ws/src/velocity_controller/launch/test.launch) (там можно задать параметры трапеции: ускорение замедление и пр.) В текущей реализации мы увидим на графиках изменения заданной скорости и ошибки управления. МР остается на месте, так как контроллер не реализован.

###Задача
1. Ваша задача реадизовать и настроить контроллер управления скоростью на базе модуля velocity_controller. Код этого модуля содержится в файле [velocity_controller/src/velocity_controller.cpp](https://github.com/AndreyMinin/MobileRobots/blob/master/mr_ws/src/velocity_controller/src/velocity_controller.cpp). Код реализован в виде фукций-колбеков, котрые подписаны на необходимые ros сообщения (заданную скорость, текущую скорость, таймер). Необходимо отредактировать код, реализовав контроллер управления скоростью. Для проверки собранного модуля выполнить пункты 4,5 (саму модель можно не перезапускать)
2. Добавим реалистичности: шум в данные одометрии. Для этого в файле запуска модели [cart_launch/launch/cart_stage.launch](https://github.com/AndreyMinin/MobileRobots/blob/master/mr_ws/src/cart_launch/launch/cart_stage.launch#L25) исправим параметр регулирующий шум в одометрии 
```xml
<param name="velocity_noise" value="0.1"/>
```
После исправления шума в файле модели необходимо перезапустить модель (шаг 3) и проверить работоспособность разработанного контроллера в присутствии шумов. Доработать контроллер скорости, добавив сглаживание на входные данные.
